<html>

<head>
    <title>REGISTRATION</title>
    <link rel="stylesheet" href="styles.css">
</head>

<script>
    let userType;

    function choose(choice) {
        userType = choice;

        // Show or hide input fields based on the selected user type
        const patientFields = document.getElementById("patientFields");
        const doctorFields = document.getElementById("doctorFields");
        const supervisorFields = document.getElementById("supervisorFields");
        const pharmacyFields = document.getElementById("pharmacyFields");
        const companyFields = document.getElementById("companyFields");

        patientFields.style.display = (choice === "Patient") ? "block" : "none";
        doctorFields.style.display = (choice === "Doctor") ? "block" : "none";
        supervisorFields.style.display = (choice === "Supervisor") ? "block" : "none";
        pharmacyFields.style.display = (choice === "Pharmacy") ? "block" : "none";
        companyFields.style.display = (choice === "PharmaceuticalCompany") ? "block" : "none";
    }

    function sendData() {
        const isBlank = /^\s*$|^\s{2,}/;
        const PASSREGEX = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).{6,24}$/;

        if (userType === "Patient") {
            var name = document.getElementById("patientName").value;
            var ssn = document.getElementById("patientSSN").value;
            var DOB = document.getElementById("patientDOB").value;
            var email = document.getElementById("patientEmail").value;
            var contact = document.getElementById("patientContact").value;
            var doctorName = document.getElementById("patientDoctorName").value;
            var password = document.getElementById('patientPassword').value;
            var address = document.getElementById("patientAddress").value;
            var dob = new Date(DOB);

            // Calculate age based on DOB
            var today = new Date();
            var age = today.getFullYear() - dob.getFullYear();
            var monthDiff = today.getMonth() - dob.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                age--; // Adjust the age if the birthdate has not been reached this year
            }

            var formattedDOB = dob.toISOString().split('T')[0];

            if (!isBlank.test(name) && !isBlank.test(ssn) && !isBlank.test(DOB) && !isBlank.test(email) && !isBlank.test(contact) && !isBlank.test(doctorName) && !isBlank.test(address) && !isBlank.test(password)) {
                if (PASSREGEX.test(password)) {
                    let data = {
                        Name: name,
                        SSN: ssn,
                        Email: email,
                        Password: password,
                        Specialty: '',
                        Address: address,
                        Age: age,
                        DOB: formattedDOB,
                        Contact: contact,
                        DoctorName: doctorName,
                        UserType: userType
                    };
                    fetch('CreateUser.php', {
                        'method': 'POST',
                        'headers': {
                            'Content-Type': 'application/json'
                        },
                        'body': JSON.stringify(data)
                    })
                        .then(response => {
                            return response.json();
                        })
                        .then(data => {
                            let feedbackElement = document.getElementById('user-feedback'); // Assuming you have an empty div with id="user-feedback"

                            if (data.status === 'success') {
                                // Provide positive feedback
                                const d = new Date();
                                console.log('sucess')
                                d.setTime(d.getTime() + (1 * 24 * 60 * 60 * 1000));
                                let expires = "expires=" + d.toUTCString();
                                document.cookie = "name=" + name + ";" + expires;
                                document.cookie = "email=" + email + ";" + expires;
                                document.cookie = "userType=" + userType + ";" + expires;
                                feedbackElement.style.display = 'block';
                            } else {
                                // Provide error feedback
                                feedbackElement.innerHTML = 'User Registion Failed';
                                feedbackElement.style.color = 'red';
                                feedbackElement.style.visibility = 'visible';
                            }

                            // Make the feedback disappear after 5 seconds
                            setTimeout(() => {
                                feedbackElement.innerHTML = '';
                                feedbackElement.style.display = 'none'
                                window.location.href='patient.html'
                            }, 7000);
                        })
                } else {
                    console.log("Invalid password");
                }
            } else {
                console.log("Incomplete credentials");
            }
        } else if (userType === "Doctor") {
            var name = document.getElementById("doctorName").value;
            var ssn = document.getElementById("doctorSSN").value;
            var email = document.getElementById("doctorEmail").value;
            var password = document.getElementById("doctorPassword").value;
            var specialty = document.getElementById("doctorSpecialty").value;
            var contact = document.getElementById("doctorContact").value;

            if (!isBlank.test(name) && !isBlank.test(ssn) && !isBlank.test(email) && !isBlank.test(password) && !isBlank.test(specialty) && !isBlank.test(contact)) {
                if (PASSREGEX.test(password)) {
                    let data = {
                        Name: name,
                        SSN: ssn,
                        Email: email,
                        Password: password,
                        Specialty: specialty,
                        Address: "",
                        Age: 0,
                        DOB: 0,
                        Contact: contact,
                        DoctorName: "",
                        UserType: userType
                    };
                    fetch('CreateUser.php', {
                        'method': 'POST',
                        'headers': {
                            'Content-Type': 'application/json'
                        },
                        'body': JSON.stringify(data)
                    })
                        .then(response => {
                            return response.json();
                        })
                        .then(data => {
                            if (data.status === 'success') {
                                const d = new Date();
                                d.setTime(d.getTime() + (1 * 24 * 60 * 60 * 1000));
                                let expires = "expires=" + d.toUTCString();
                                document.cookie = "name=" + name + ";" + expires;
                                document.cookie = "email=" + email + ";" + expires;
                                document.cookie = "userType=" + userType + ";" + expires;
                                window.location.href = "Doctor.html";

                            } else {
                                console.error(data.message);
                            }
                        })
                        .catch(error => {
                            console.error('An error occurred:', error);
                        });
                } else {
                    console.log("Invalid credentials");
                }
            } else {
                console.log("Incomplete credentials");
            }
        } else if (userType === "Supervisor") {
            var name = document.getElementById("supervisorName").value;
            var email = document.getElementById("supervisorEmail").value;
            var password = document.getElementById("supervisorPassword").value;
            var contact = document.getElementById("supervisorContact").value;

            if (!isBlank.test(name) && !isBlank.test(email) && !isBlank.test(password) && !isBlank.test(contact)) {
                if (PASSREGEX.test(password)) {
                    let data = {
                        Name: name,
                        SSN: 0,
                        Email: email,
                        Password: password,
                        Specialty: '',
                        Address: "",
                        Age: 0,
                        DOB: 0,
                        Contact: contact,
                        DoctorName: "",
                        UserType: userType
                    };
                    fetch('CreateUser.php', {
                        'method': 'POST',
                        'headers': {
                            'Content-Type': 'application/json'
                        },
                        'body': JSON.stringify(data)
                    })
                        .then(response => {
                            return response.json();
                        })
                        .then(data => {
                            if (data.status === 'success') {
                                const d = new Date();
                                d.setTime(d.getTime() + (1 * 24 * 60 * 60 * 1000));
                                let expires = "expires=" + d.toUTCString();
                                document.cookie = "name=" + name + ";" + expires;
                                document.cookie = "email=" + email + ";" + expires;
                                document.cookie = "userType=" + userType + ";" + expires;
                                window.location.href = "Supervisor.html";

                            } else {
                                console.error(data.message);
                            }
                        })
                        .catch(error => {
                            console.error('An error occurred:', error);
                        });
                } else {
                    console.log("Invalid credentials");
                }
            } else {
                console.log("Incomplete credentials");
            }
        } else if (userType === "Pharmacy") {
            var name = document.getElementById("pharmacyName").value;
            var email = document.getElementById("pharmacyEmail").value;
            var password = document.getElementById("pharmacyPassword").value;
            var contact = document.getElementById("pharmacyContact").value;
            var pharmacyAddress = document.getElementById("pharmacyAddress").value;

            if (!isBlank.test(name) && !isBlank.test(email) && !isBlank.test(password) && !isBlank.test(contact) && !isBlank.test(pharmacyAddress)) {
                if (PASSREGEX.test(password)) {
                    let data = {
                        Name: name,
                        SSN: 0,
                        Email: email,
                        Password: password,
                        Specialty: '',
                        Address: pharmacyAddress,
                        Age: 0,
                        DOB: 0,
                        Contact: 0,
                        DoctorName: "",
                        UserType: userType
                    };
                    fetch('CreateUser.php', {
                        'method': 'POST',
                        'headers': {
                            'Content-Type': 'application/json'
                        },
                        'body': JSON.stringify(data)
                    })
                        .then(response => {
                            return response.json();
                        })
                        .then(data => {
                            if (data.status === 'success') {
                                const d = new Date();
                                d.setTime(d.getTime() + (1 * 24 * 60 * 60 * 1000));
                                let expires = "expires=" + d.toUTCString();
                                document.cookie = "name=" + name + ";" + expires;
                                document.cookie = "email=" + email + ";" + expires;
                                document.cookie = "userType=" + userType + ";" + expires;
                                window.location.href = "Pharmacy.html";

                            } else {
                                console.error(data.message);
                            }
                        })
                        .catch(error => {
                            console.error('An error occurred:', error);
                        });
                } else {
                    console.log("Invalid credentials");
                }
            } else {
                console.log("Incomplete credentials");
            }
        } else if (userType === "PharmaceuticalCompany") {
            var password = document.getElementById("companyPassword").value;
            var name = document.getElementById("companyName").value;
            var email = document.getElementById("companyEmail").value;
            var contact = document.getElementById("companyContact").value;
            console.log(userType)
            if (!isBlank.test(name) && !isBlank.test(email) && !isBlank.test(password) && !isBlank.test(contact)) {
                if (PASSREGEX.test(password)) {
                    let data = {
                        Name: name,
                        SSN: 0,
                        Email: email,
                        Password: password,
                        Specialty: '',
                        Address: "",
                        Age: 0,
                        DOB: 0,
                        Contact: 0,
                        DoctorName: "",
                        UserType: userType
                    };
                    fetch('CreateUser.php', {
                        'method': 'POST',
                        'headers': {
                            'Content-Type': 'application/json'
                        },
                        'body': JSON.stringify(data)
                    })
                        .then(response => {
                            return response.json();
                        })
                        .then(data => {
                            if (data.status === 'success') {
                                const d = new Date();
                                d.setTime(d.getTime() + (1 * 24 * 60 * 60 * 1000));
                                let expires = "expires=" + d.toUTCString();
                                document.cookie = "name=" + name + ";" + expires;
                                document.cookie = "email=" + email + ";" + expires;
                                document.cookie = "userType=" + userType + ";" + expires;
                                window.location.href = "PharmaceuticalCompany.html";

                            } else {
                                console.error(data.message);
                            }
                        })
                        .catch(error => {
                            console.error('An error occurred:', error);
                        });
                } else {
                    console.log("Invalid credentials");
                }
            } else {
                console.log("Incomplete credentials");
            }
        } else {
            console.log("Incomplete credentials");
        }

    }
    function handleNav() {
        window.location.href = "login.html";
    }

</script>

<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

<body>
    <section class="background-containers">
        <div class="navbar">
            <img src="images/afyahealth.png" class="logo">
            <ul>
                <li><a href="login.html">LogIn</a></li>
            </ul>
        </div>
        </div>
        <div class="content">
            <h1>REGISTRATION <ion-icon name="people-circle-outline"></ion-icon>
            </h1>
            <p class="para">Welcome Kindly Register Your Details Below </p>

            <form onsubmit="event.preventDefault(); sendData();">
                <!-- User type selection -->
                <div id="user-feedback" class="user-feedback">
                    <div id="user-feedback-text" class="user-feedback-text">
                        User Registered Successfully
                    </div>
                    <div id="continue-to-HomePage" class="continue-to-HomePage" onClick="window.location.href='patient.html'">
                        Conitue
                    </div>
                </div>

                <label onclick="choose('Patient')">
                    <input type="radio" name="userType" value="Patient">
                    <ion-icon name="person"></ion-icon> Patient
                </label>
                <label onclick="choose('Doctor')">
                    <input type="radio" name="userType" value="Doctor">
                    <ion-icon name="medkit-outline"></ion-icon> Doctor
                </label>
                <label onclick="choose('Supervisor')">
                    <input type="radio" name="userType" value="Supervisor">
                    <ion-icon name="people"></ion-icon> Supervisor
                </label>
                <label onclick="choose('Pharmacy')">
                    <input type="radio" name="userType" value="Pharmacy">
                    <ion-icon name="cart"></ion-icon> Pharmacy
                </label>
                <label onclick="choose('PharmaceuticalCompany')">
                    <input type="radio" name="userType" value="PharmaceuticalCompany">
                    <ion-icon name="business"></ion-icon> Pharmaceutical Company
                </label>

                <div id="userTypeSelection">
                    <!-- Patient fields -->
                    <div id="patientFields" style="display: none;">
                        <input type="text" class="login-input" id="patientName" placeholder="Name">
                        <br>
                        <input type="number" class="login-input" id="patientSSN" placeholder="SSN">
                        <br>
                        <input type="date" class="login-input" id="patientDOB" placeholder="DOB">
                        <br>
                        <input type="text" class="login-input" id="patientEmail" placeholder="Email">
                        <br>
                        <input type="password" class="login-input" id="patientPassword" placeholder="Password">
                        <br>
                        <input type="text" class="login-input" id="patientContact" placeholder="Contact">
                        <br>
                        <input type="text" class="login-input" id="patientDoctorName" placeholder="Doctor Name">
                        <br>
                        <input type="text" class="login-input" id="patientAddress" placeholder="Address">
                        <br>
                        <div style="flex-direction: row; justify-content:space-between;">
                            <button type="submit"><span></span>Register</button>
                            <button style="margin-left:200px" onclick="handleNav()"><span></span>Login</button>
                        </div>

                    </div>

                    <!-- Doctor fields -->
                    <div id="doctorFields" style="display: none;">
                        <br>
                        <input type="text" class="login-input" id="doctorName" placeholder="Name">
                        <br>
                        <input type="number" class="login-input" id="doctorSSN" placeholder="SSN">
                        <br>
                        <input type="text" class="login-input" id="doctorEmail" placeholder="Email">
                        <br>
                        <input type="password" class="login-input" id="doctorPassword" placeholder="Password">
                        <br>
                        <input type="text" class="login-input" id="doctorSpecialty" placeholder="Specialty">
                        <br>
                        <input type="text" class="login-input" id="doctorContact" placeholder="Contact">
                        <br>
                        <div style="flex-direction: row; justify-content:space-between;">
                            <button type="submit"><span></span>Register</button>
                            <button style="margin-left:200px" onclick="handleNav()"><span></span>Login</button>
                        </div>

                    </div>

                    <!-- Supervisor fields -->
                    <div id="supervisorFields" style="display: none;">
                        <br>
                        <input type="text" class="login-input" id="supervisorName" placeholder="Name">
                        <br>
                        <input type="text" class="login-input" id="supervisorEmail" placeholder="Email">
                        <br>
                        <input type="password" class="login-input" id="supervisorPassword" placeholder="Password">
                        <br>
                        <input type="text" class="login-input" id="supervisorContact" placeholder="Contact">
                        <br>
                        <div style="flex-direction: row; justify-content:space-between;">
                            <button type="submit"><span></span>Register</button>
                            <button style="margin-left:200px" onclick="handleNav()"><span></span>Login</button>
                        </div>

                    </div>

                    <!-- Pharmacy fields -->
                    <div id="pharmacyFields" style="display: none;">
                        <br>
                        <input type="text" class="login-input" id="pharmacyName" placeholder="Name">
                        <br>
                        <input type="text" class="login-input" id="pharmacyEmail" placeholder="Email">
                        <br>
                        <input type="password" class="login-input" id="pharmacyPassword" placeholder="Password">
                        <br>
                        <input type="text" class="login-input" id="pharmacyContact" placeholder="Contact">
                        <br>
                        <input type="text" class="login-input" id="pharmacyAddress" placeholder="Address">
                        <br />
                        <div style="flex-direction: row; justify-content:space-between;">
                            <button type="submit"><span></span>Register</button>
                            <button style="margin-left:200px" onclick="handleNav()"><span></span>Login</button>
                        </div>

                    </div>

                    <!-- Pharmaceutical Company fields -->
                    <div id="companyFields" style="display: none;">
                        <br>
                        <input type="text" class="login-input" id="companyName" placeholder="Name">
                        <br>
                        <input type="text" class="login-input" id="companyEmail" placeholder="Email">
                        <br>
                        <input type="password" class="login-input" id="companyPassword" placeholder="Password">
                        <br>
                        <input type="text" class="login-input" id="companyContact" placeholder="Contact">
                        <br>
                        <div style="flex-direction: row; justify-content:space-between;">
                            <button type="submit"><span></span>Register</button>
                            <button style="margin-left:200px" onclick="handleNav()"><span></span>Login</button>
                        </div>

                    </div>
                </div>
    </section>

    <section class="purpose">
        <h1>Kindly Register Your Details Above</h1>
        <p>We are pleased to have you all trust our platform</p>
    </section>
    </form>
</body>

</html>